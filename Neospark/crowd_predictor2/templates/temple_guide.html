{% extends "base.html" %}

{% block title %}Temple Guide - {{ temple.name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('temples') }}">Temples</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('temple_detail', temple_id=temple.id) }}">{{ temple.name }}</a></li>
                <li class="breadcrumb-item active">Complete Guide</li>
            </ol>
        </nav>
    </div>
</div>

<!-- Quick Navigation -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <h3><i class="bi bi-compass"></i> Complete Temple Guide</h3>
                <p class="mb-3">Everything you need to know for your visit to {{ temple.name }}</p>
                <div class="btn-group" role="group">
                    <button class="btn btn-light btn-sm" onclick="scrollToSection('overview')">Overview</button>
                    <button class="btn btn-light btn-sm" onclick="scrollToSection('planning')">Plan Visit</button>
                    <button class="btn btn-light btn-sm" onclick="scrollToSection('directions')">Directions</button>
                    <button class="btn btn-light btn-sm" onclick="scrollToSection('rituals')">Rituals</button>
                    <button class="btn btn-light btn-sm" onclick="scrollToSection('facilities')">Facilities</button>
                    <button class="btn btn-light btn-sm" onclick="scrollToSection('tips')">Tips</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Temple Overview -->
<div id="overview" class="row mb-4">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h5><i class="bi bi-info-circle"></i> Temple Overview</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <img src="{{ temple.image_url or '/static/temple_default.jpg' }}" class="img-fluid rounded mb-3" alt="{{ temple.name }}">
                    </div>
                    <div class="col-md-6">
                        <h4>{{ temple.name }}</h4>
                        <p><i class="bi bi-geo-alt"></i> {{ temple.location }}</p>
                        <p class="text-muted">{{ temple.description or 'A sacred place of worship with rich history and spiritual significance.' }}</p>
                        
                        <div class="row text-center mt-3">
                            <div class="col-4">
                                <div class="bg-light p-2 rounded">
                                    <i class="bi bi-clock text-primary fs-4"></i>
                                    <div class="small">Opens</div>
                                    <strong>{{ temple.opening_time or '6:00 AM' }}</strong>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="bg-light p-2 rounded">
                                    <i class="bi bi-clock-history text-warning fs-4"></i>
                                    <div class="small">Closes</div>
                                    <strong>{{ temple.closing_time or '8:00 PM' }}</strong>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="bg-light p-2 rounded">
                                    <i class="bi bi-people text-success fs-4"></i>
                                    <div class="small">Capacity</div>
                                    <strong>{{ temple.capacity }}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h6><i class="bi bi-lightning-charge"></i> Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('temple_detail', temple_id=temple.id) }}" class="btn btn-primary">
                        <i class="bi bi-calendar-plus"></i> Book Now
                    </a>
                    <button class="btn btn-outline-info" onclick="showDirections()">
                        <i class="bi bi-map"></i> Get Directions
                    </button>
                    <button class="btn btn-outline-warning" onclick="checkCrowdStatus()">
                        <i class="bi bi-people"></i> Check Crowd
                    </button>
                    <button class="btn btn-outline-success" onclick="downloadGuide()">
                        <i class="bi bi-download"></i> Download Guide
                    </button>
                    <a href="{{ url_for('visitor_journey_page', temple_id=temple.id) }}" class="btn btn-outline-primary">
                        <i class="bi bi-person-gear"></i> Personalized Journey
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Visit Planning -->
<div id="planning" class="row mb-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-warning text-dark">
                <h5><i class="bi bi-calendar-check"></i> Plan Your Visit</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="bi bi-clock"></i> Best Time to Visit</h6>
                        <div class="alert alert-info">
                            <strong>Morning:</strong> 6:00 AM - 9:00 AM<br>
                            <small>Less crowded, peaceful atmosphere</small>
                        </div>
                        <div class="alert alert-warning">
                            <strong>Evening:</strong> 6:00 PM - 8:00 PM<br>
                            <small>Evening aarti, moderate crowd</small>
                        </div>
                        <div class="alert alert-danger">
                            <strong>Avoid:</strong> 11:00 AM - 2:00 PM<br>
                            <small>Peak hours, very crowded</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-calendar3"></i> Special Days</h6>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-star text-warning"></i> <strong>Mondays:</strong> Shiva worship</li>
                            <li><i class="bi bi-star text-warning"></i> <strong>Fridays:</strong> Devi worship</li>
                            <li><i class="bi bi-star text-warning"></i> <strong>Full Moon:</strong> Special prayers</li>
                            <li><i class="bi bi-star text-warning"></i> <strong>Festivals:</strong> Extended hours</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-stopwatch"></i> Time Required</h6>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-success" style="width: 30%">Quick Visit</div>
                        </div>
                        <small>30-45 minutes: Darshan only</small>
                        
                        <div class="progress mb-2 mt-3">
                            <div class="progress-bar bg-info" style="width: 60%">Regular Visit</div>
                        </div>
                        <small>1-2 hours: Darshan + Prasad + Prayers</small>
                        
                        <div class="progress mb-2 mt-3">
                            <div class="progress-bar bg-warning" style="width: 100%">Complete Visit</div>
                        </div>
                        <small>2-3 hours: Full experience + Pooja</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Directions & Transportation -->
<div id="directions" class="row mb-4">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5><i class="bi bi-geo-alt"></i> How to Reach</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6><i class="bi bi-car-front"></i> By Car/Taxi</h6>
                    <p class="small">{{ temple.location }} - Parking available near temple premises</p>
                    <button class="btn btn-sm btn-outline-primary" onclick="openMaps('car')">
                        <i class="bi bi-navigation"></i> Car Route
                    </button>
                </div>
                
                <div class="mb-3">
                    <h6><i class="bi bi-bus-front"></i> By Public Transport</h6>
                    <p class="small">Local buses available. Nearest bus stop: Temple Road</p>
                    <button class="btn btn-sm btn-outline-success" onclick="openMaps('transit')">
                        <i class="bi bi-bus-front"></i> Public Transport
                    </button>
                </div>
                
                <div class="mb-3">
                    <h6><i class="bi bi-train-front"></i> By Train</h6>
                    <p class="small">Nearest railway station: 5 km from temple</p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-secondary text-white">
                <h5><i class="bi bi-map"></i> Temple Map</h5>
            </div>
            <div class="card-body text-center">
                <div id="templeMap" style="height: 250px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                    <div>
                        <i class="bi bi-map fs-1 text-muted"></i>
                        <p class="text-muted">Interactive temple layout</p>
                        <button class="btn btn-primary btn-sm" onclick="showInteractiveMap()">
                            <i class="bi bi-fullscreen"></i> View Full Map
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Rituals & Worship -->
<div id="rituals" class="row mb-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h5><i class="bi bi-heart"></i> Rituals & Worship Guide</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="text-center mb-3">
                            <div class="bg-light p-3 rounded-circle d-inline-block">
                                <i class="bi bi-1-circle fs-1 text-primary"></i>
                            </div>
                            <h6 class="mt-2">Entry</h6>
                            <p class="small">Remove shoes, wash hands</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center mb-3">
                            <div class="bg-light p-3 rounded-circle d-inline-block">
                                <i class="bi bi-2-circle fs-1 text-success"></i>
                            </div>
                            <h6 class="mt-2">Darshan</h6>
                            <p class="small">Queue for main deity viewing</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center mb-3">
                            <div class="bg-light p-3 rounded-circle d-inline-block">
                                <i class="bi bi-3-circle fs-1 text-warning"></i>
                            </div>
                            <h6 class="mt-2">Prayers</h6>
                            <p class="small">Offer prayers, light lamps</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center mb-3">
                            <div class="bg-light p-3 rounded-circle d-inline-block">
                                <i class="bi bi-4-circle fs-1 text-info"></i>
                            </div>
                            <h6 class="mt-2">Prasad</h6>
                            <p class="small">Collect blessed offerings</p>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h6><i class="bi bi-gift"></i> Available Offerings</h6>
                        <div class="row">
                            {% for prasad in prasads %}
                            <div class="col-6 mb-2">
                                <div class="border rounded p-2 text-center">
                                    <strong>{{ prasad.name }}</strong><br>
                                    <span class="text-success">₹{{ prasad.price }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="bi bi-candle"></i> Special Poojas</h6>
                        <div class="row">
                            {% for pooja in poojas %}
                            <div class="col-12 mb-2">
                                <div class="border rounded p-2">
                                    <strong>{{ pooja.name }}</strong>
                                    <span class="float-end text-success">₹{{ pooja.price }}</span><br>
                                    <small class="text-muted">Duration: {{ pooja.duration }} minutes</small>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Facilities & Services -->
<div id="facilities" class="row mb-4">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h5><i class="bi bi-building"></i> Facilities Available</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6 mb-3">
                        <i class="bi bi-p-square text-primary"></i> <strong>Parking</strong><br>
                        <small>Free parking available</small>
                    </div>
                    <div class="col-6 mb-3">
                        <i class="bi bi-droplet text-info"></i> <strong>Drinking Water</strong><br>
                        <small>Clean water facility</small>
                    </div>
                    <div class="col-6 mb-3">
                        <i class="bi bi-house text-success"></i> <strong>Rest Area</strong><br>
                        <small>Seating arrangements</small>
                    </div>
                    <div class="col-6 mb-3">
                        <i class="bi bi-shop text-warning"></i> <strong>Prasad Shop</strong><br>
                        <small>Religious items available</small>
                    </div>
                    <div class="col-6 mb-3">
                        <i class="bi bi-shield-check text-danger"></i> <strong>Security</strong><br>
                        <small>24/7 security available</small>
                    </div>
                    <div class="col-6 mb-3">
                        <i class="bi bi-telephone text-secondary"></i> <strong>Help Desk</strong><br>
                        <small>Information counter</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-warning text-dark">
                <h5><i class="bi bi-exclamation-triangle"></i> Important Guidelines</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <h6><i class="bi bi-check-circle"></i> Do's</h6>
                    <ul class="mb-0 small">
                        <li>Dress modestly and appropriately</li>
                        <li>Maintain silence in prayer areas</li>
                        <li>Follow queue discipline</li>
                        <li>Keep mobile phones on silent</li>
                        <li>Respect temple customs</li>
                    </ul>
                </div>
                
                <div class="alert alert-danger">
                    <h6><i class="bi bi-x-circle"></i> Don'ts</h6>
                    <ul class="mb-0 small">
                        <li>No photography inside sanctum</li>
                        <li>No leather items allowed</li>
                        <li>No smoking or alcohol</li>
                        <li>Don't touch deity idols</li>
                        <li>No loud conversations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tips & Recommendations -->
<div id="tips" class="row mb-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-dark text-white">
                <h5><i class="bi bi-lightbulb"></i> Pro Tips for First-Time Visitors</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="bi bi-clock-history text-primary"></i> Time Management</h6>
                        <ul class="small">
                            <li>Book slots in advance to avoid waiting</li>
                            <li>Arrive 15 minutes before your slot</li>
                            <li>Check crowd status before leaving</li>
                            <li>Plan for 2-3 hours total visit time</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-bag text-success"></i> What to Bring</h6>
                        <ul class="small">
                            <li>Valid ID for verification</li>
                            <li>Small bag for prasad</li>
                            <li>Water bottle (if allowed)</li>
                            <li>Comfortable footwear (easy to remove)</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-currency-rupee text-warning"></i> Budget Planning</h6>
                        <ul class="small">
                            <li>Darshan: ₹50 per person</li>
                            <li>Prasad: ₹15-50 per item</li>
                            <li>Special Pooja: ₹51-251</li>
                            <li>Parking: Usually free</li>
                        </ul>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle"></i> Insider Tips</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="small mb-0">
                                        <li>Use our mobile app for real-time updates</li>
                                        <li>Pre-book prasad to skip queues</li>
                                        <li>Follow temple social media for special events</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="small mb-0">
                                        <li>Download offline maps before visiting</li>
                                        <li>Carry exact change for offerings</li>
                                        <li>Check weather forecast and dress accordingly</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Contact & Emergency -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-danger text-white">
                <h5><i class="bi bi-telephone"></i> Emergency Contacts</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <i class="bi bi-shield-plus fs-2 text-danger"></i>
                        <h6>Temple Security</h6>
                        <strong>+91-XXXX-XXXX</strong>
                    </div>
                    <div class="col-6">
                        <i class="bi bi-hospital fs-2 text-success"></i>
                        <h6>Medical Help</h6>
                        <strong>108</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h5><i class="bi bi-chat-dots"></i> Need Help?</h5>
            </div>
            <div class="card-body text-center">
                <p>Have questions about your visit?</p>
                <button class="btn btn-primary" onclick="openChatbot()">
                    <i class="bi bi-robot"></i> Chat with Temple Assistant
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function scrollToSection(sectionId) {
    document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
}

function showDirections() {
    const location = "{{ temple.location }}";
    const url = `https://www.google.com/maps/search/${encodeURIComponent(location)}`;
    window.open(url, '_blank');
}

function checkCrowdStatus() {
    fetch('/api/temple/{{ temple.id }}/crowd')
    .then(response => response.json())
    .then(data => {
        const status = data.status || 'Unknown';
        const count = data.count || 0;
        alert(`Current Crowd Status: ${status}\nPeople Count: ${count}\nAccuracy: ${Math.round((data.accuracy || 0) * 100)}%`);
    })
    .catch(() => alert('Unable to fetch crowd status. Please try again.'));
}

function downloadGuide() {
    const content = document.documentElement.outerHTML;
    const blob = new Blob([content], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '{{ temple.name }}_guide.html';
    a.click();
}

function openMaps(mode) {
    const location = "{{ temple.location }}";
    let url = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(location)}`;
    if (mode === 'transit') {
        url += '&travelmode=transit';
    }
    window.open(url, '_blank');
}

function showInteractiveMap() {
    alert('Interactive temple map feature coming soon!');
}

function openChatbot() {
    // Integrate with existing chatbot
    window.location.href = '/chatbot';
}
</script>

<style>
.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}

.progress {
    height: 8px;
}

.alert {
    border-left: 4px solid;
}

.alert-info {
    border-left-color: #17a2b8;
}

.alert-success {
    border-left-color: #28a745;
}

.alert-warning {
    border-left-color: #ffc107;
}

.alert-danger {
    border-left-color: #dc3545;
}
</style>
{% endblock %}